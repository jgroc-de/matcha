{% extends 'templates/home.html.twig' %}
{% from 'macro/home/profilButton.html.twig' import profilButton %}
{% from 'macro/home/subsectionTitle.html.twig' import subtitle %}

{% set color = {
    'Rick': '#878f99',
    'Jerry': '#ff7b25',
    'Beth': '#6b5b95',
    'Morty': '#feb236',
    'Summer': '#d64161',
} %}

{% block main %}
<div class="w3-content w3-section w3-card-4 w3-theme-l5" style="max-width:95vw">
    <div id="flash" class="w3-panel w3-green w3-hide" style="position:fixed;bottom:10px;right:10px;z-index:20"><p id="flashText"></p></div>
    <div class="w3-padding w3-row">
        {% if profil.id == me.id %}
            {% set hi = 'Hi ' %}
            {% set your = 'Your ' %}
            {% set home = true %}
        {% endif %}
        <!-- The Modal -->
        <div id="Modal" class="w3-modal" style="cursor:pointer" onclick="this.style.display='none'">
            <div class="w3-modal-content w3-card-4" style="width:90vw;background-color:black;">
                <div class="w3-display-container" style="height:80vh">
                    <img class="w3-display-middle" src="" style="max-height:80vh;max-width:100%" alt="profil image large">
                </div>
            </div>
        </div>
        <h2 class='' style="margin-bottom:0;background-color: {{ color[profil.gender] }}">{{ hi }}{{ profil.pseudo }}</h2>
        {% if not home and not isFriend %}
            <div class="w3-row">
                {% if isLiked %}
                    <button class="w3-button w3-theme-l2 w3-third" onclick="profilAction('/friendReq/{{ profil.id }}', true)" >unlike</button>
                {% else %}
                    <button class="w3-button w3-theme-l2 w3-third" onclick="profilAction('/friend/{{ profil.id }}')" >add to friends</button>
                {% endif %}
                <button class="w3-button w3-theme-l1 w3-third" onclick="profilAction('/report/{{ profil.id }}')">report as fake user</button>
                <button class="w3-button w3-theme-d1 w3-third" onclick="profilAction('/blacklist/{{ profil.id }}')">blacklist this user</button>
            </div>
        {% endif %}
        <div class="w3-row {% if home %}w3-col l6 s12{% endif %}">
            <div class="w3-half w3-padding">
                <div class="w3-card-4">
                    {{ subtitle('Profil', home, 'fa fa-gear', path_for('editProfil'), 'edit profil', true) }}
                    <div id="Profil" class="w3-theme-l4 w3-padding gg-section">
                        <div class="w3-left-align">
                            {% if not home %}<span id="online" class="w3-text-green w3-hide">(online)<br></span>
                            <span id="offline" class="w3-text-blue">(offline since: {{ profil.lastlog|date('d M Y') }})<br></span>
                            {% else %}
                                Name : {{ profil.name}} {{profil.surname}}<br>
                                Email : {{ profil.email }}<br>
                            {% endif %}
                            {% if home %}You are{% else %}it's{% endif %} a {{ profil.gender }} aged of {{ "now"|date("Y") - profil.birthdate }} yo and {{ profil.sexuality }}.<br>
                                Popularity score : <div class="w3-theme-l5 w3-border w3-round w3-margin-right" style="width:100px;" title="popularity: {{ profil.popularity }}/100">
                                    <div class="w3-round w3-green w3-border" style="width:{{ profil.popularity }}%;height:16px"></div>
                                </div>
                                Story : {{ profil.biography }}<br>
                        </div>
                    </div>
                </div>
            </div>
            <div class="w3-half w3-padding">
                <div class="w3-card-4">
                    {{ subtitle('Interest', home, 'fa fa-plus',  "addTag('/tag')", 'add tag') }}
                    <div id="Interest" class="w3-theme-l4 gg-section w3-padding" id="userTag">
                        {% for tag in tags %}
                        {{ profilButton(color, tag, "delUserTag('/tag/', #{ tag.id })", home, NULL, 'tag') }}
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
        {% if home %}
            <div class="w3-row w3-col l6 s12">
                <div class="w3-half w3-padding">
                    <div class="w3-card-4">
                        <h3 class="w3-hover-green" style="cursor:pointer" onclick="toggleSibling(this)">{{ your }}Friend Request</h3><div id="FriendR" class="w3-theme-l4 w3-padding gg-section">
                            {% for req in friendReq %}
                                {% if req.visible %}
                                    {{ profilButton(color, req, "delFriendReq('/friendReq/', #{ req.id })", home, path_for('profil', req), 'req') }}
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <div class="w3-half w3-padding">
                    <div class="w3-card-4">
                        <h3 class="w3-hover-green" style="cursor:pointer"  onclick="toggleSibling(this)">{{ your }}Friends</h3>
                        <div id="Friend" class="w3-theme-l4 w3-padding gg-section">
                            {% for friend in friends %}
                                <div class="gg-friend">
                                    <a class="" href="/profil/{{friend.id}}">
                                        <img src="{{ friend.img1 }}" alt="{{ friend.name }}'s picture" class="gg-friend-img" style="border-color:{{color[friend.gender]}};">
                                        {{friend.name}}
                                    </a>
                                    <i class="fa fa-remove" onclick="delFriend('/friend/', {{friend.id}})" title="remove"></i>
                                </div>
                                <!--{{ profilButton(color, friend, "delFriend('/friend/', #{ friend.id })", home, path_for('profil', friend), 'friend') }}-->
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
        <div class="w3-row w3-padding w3-col s12">
            <div class="w3-row w3-card-4 w3-black w3-col l6 s12" style="overflow:auto">
                <h3 class="w3-hover-green" style="cursor:pointer"  onclick="toggleSibling(this)">{{ your }}Pictures</h3>
                <div id="Picture" style="height:255px">
                    {% if home %}
                        {% include 'templates/profil/my_img.html.twig' with imgs only %}
                    {% else %}
                        {% include 'templates/profil/other_img.html.twig' with imgs only %}
                    {% endif %}
                </div>
            </div>
            <div class="w3-row w3-card-4 w3-col l6 s12 w3-white">
                <h3 class="w3-hover-green" style="cursor:pointer" onclick="toggleDisplay2(this)">{{ your }}Location</h3>
                <div id="Location" class="gg-map-small" style="height:255px"></div>
                {% if home %}
                <div class="w3-padding w3-row">
                    <p id="textLocation">You are currently located at {{ profil.lattitude }}° of lattitude north and {{ profil.longitude }}° of longitude east.</p>
                    <div class="w3-half">
                        <label for="lat">lattitude</label>
                        <input
                               id="lat"
                               class="w3-input w3-border"
                               type="number"
                               name="lat"
                               value={{ profil.lattitude }}
                               min="-85"
                               max="85"
                               step="0.0000001"
                               onchange="changeLocation()">
                    </div>
                    <div class="w3-half">
                        <label for="lng">longitude</label>
                        <input
                               id="lng"
                               class="w3-input w3-border"
                               type="number"
                               name="lng"
                               value={{ profil.longitude }}
                               min="-180"
                               max="180"
                               step="0.0000001"
                               onchange="changeLocation()">
                    </div>
                    <div class="w3-right w3-half w3-section">
                    <button class="w3-button w3-half w3-ripple w3-theme-l1 w3-hover-green" type="button" onclick="setLocation()">set</button>
                    <button class="w3-button w3-half w3-ripple w3-theme-d1 w3-hover-green" type="button" onclick="updateGeolocation()">reset</button>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
    <script>
        var user =  {id: {{ profil.id }}, title: '{{ profil.pseudo }}', lat: {{ profil.lattitude }}, lng: {{ profil.longitude }} };
        var usersPos = [
            {% for user in friends %}
                {lat: {{ user.lattitude }}, lng: {{ user.longitude }}, title: '{{ user.pseudo }}', img: '{{ user.img1 }}', id: '{{ user.id }}', kind: '{{ user.gender }}'},
            {% endfor %}
        ];
        var myId = '{{ me.publicToken }}';
    </script>
    {% if profil.id == me.id %}
        <script src="{{ BASE_URL }}/js/myProfile.js"></script>
    {% else %}
        <script src="{{ BASE_URL }}/js/otherProfil.js"></script>
    {% endif %}
    <script src="{{ BASE_URL }}/js/autobahn.js"></script>
    <script src="{{ BASE_URL }}/js/notification.js"></script>
    <script src="{{ BASE_URL }}/js/geolocation.js"></script>
    <script defer async src="https://maps.googleapis.com/maps/api/js?key={{ mapKey }}&callback=initMap"></script>
{% endblock %}
