{% extends 'templates/logForm.html.twig' %}
{% from 'macro/form/input.html.twig' import input %}
{% from 'macro/form/button.html.twig' import button %}
{% from 'macro/form/select.html.twig' import select %}
{% from 'macro/form/layout.html.twig' import form %}

{% block main %}
<div class="w3-content w3-card-4 w3-margin-top w3-theme-light" style="width:90vw;max-width:500px">
    {{ form('Log In', 'login', flash, login) }}
        <div class="w3-section">
            {{ input('text', 'pseudo', {'id': 'pseudo1', 'value': post.pseudo, 'pattern': '[^\ \'\"]+'}) }}
        </div>
        <div class="w3-section">
            {{ input('password', 'password', {'id': 'password1'}) }}
        </div>
        <div class="">
            {{ button('submit', 'login') }}
            <a class="w3-button w3-right w3-ripple w3-theme-l2 w3-hover-green w3-margin-left w3-margin-bottom"
                   href="https://api.intra.42.fr/oauth/authorize?client_id={{ PUB_42_KEY }}&redirect_uri={{ BASE_URL }}{{ path_for('apiLogin', {'name': '42'}) }}&response_type=code"
            >
                <img src="https://meta.intra.42.fr/assets/42_logo-7dfc9110a5319a308863b96bda33cea995046d1731cebb735e41b16255106c12.svg">
                <p>login</p>
            </a>
            <div class="w3-right g-signin2" data-onsuccess="onSignIn" data-theme="dark"></div>
        </div>
    </form>
    {{ form('Reset Your Password', 'resetPassword', flash, reset) }}
        <div class="w3-section">
            {{ input('email', 'email', {'id': 'email1', 'value': post.email }) }}
        </div>
        <div class="">
            {{ button('submit', 'send') }}
        </div>
    </form>
    {{ form('Sign Up', 'signup', flash, signup) }}
        <div class="w3-section">
            {{ input('text', 'pseudo', {'value': post.pseudo, 'pattern': '[^\ \'\"]+'}) }}
        </div>
        <div class="w3-section">
            <div id="infopwd" class="w3-panel w3-green">
                <p>Your password must contain at least:</p>
                <ul>
                    <li>8 characters</li>
                    <li>1 upper case letter</li>
                    <li>1 lower case letter</li>
                    <li>1 number</li>
                </ul>
            </div>
            {{ input('password','password') }}
        </div>
        <div class="w3-section">
            {{ input('password','password confirmation') }}
        </div>
        <div class="w3-section">
            {{ input('email', 'email', {'value': post.email }) }}
        </div>
        <div class="w3-section">
            {{ input('text', 'name', {'value': post.name|default("Ann") }) }}
        </div>
        <div class="w3-section">
            {{ input('text', 'surname', {'value': post.surname|default("Onymous") }) }}
        </div>
        <div class="w3-section">
            {{ select({'label': 'you are a', 'name': 'gender', 'array': characters, 'select': post.gender}) }}
        </div>
        <div class="w3-section g-recaptcha" data-sitekey="{{ PUB_CAPTCHA_KEY }}"></div>
        <div class="">
            {{ button('submit', 'signup') }}
            {{ button('reset') }}
        </div>
    </form>
</div>
{% endblock %}

{% block script %}
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script>
		function onSignIn(googleUser) {
			var id_token = googleUser.getAuthResponse().id_token
			var xhr = new XMLHttpRequest();

			xhr.open('POST', '{{ path_for('apiLogin', {'name': 'google'}) }}')
			xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
			xhr.onreadystatechange = function() {
				if (this.readyState === 4 && this.status === 200) {
					//console.log(xhr.responseText)
					window.location.replace(xhr.responseText);
				}
			}
			xhr.send('idtoken=' + id_token)
		}
    </script>
{% endblock %}
