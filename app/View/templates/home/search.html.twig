{% extends 'templates/home.html.twig' %}
{% from 'macro/form/button.html.twig' import button %}
{% from 'macro/form/input.html.twig' import input %}
{% from 'macro/form/select.html.twig' import select %}


{% block main %}
<div class="w3-content w3-section w3-card-4 w3-theme-l5" style="max-width:95vw;min-height:80vh"> 
    <div class="w3-padding w3-row">
    <h2 class='w3-theme-l1'>Search</h2>
    <div class="w3-row w3-col l8">
        <h3 class="w3-hover-green" style="cursor:pointer" onclick="toggleDisplay('try')">Try them</h3>
        <div id="try" class="w3-col s12 w3-row">
            {% set i = 0 %}
            {% for user in users if i < 8 %}
                {% set i = i + 1 %}
            <div class="w3-col s12 m3">
                <div class="w3-theme-l4" style="height:100px;overflow:auto">
                    <div class="w3-theme-l1" style="width:100%;height:31px;position:sticky;top:0">
                        <a href="{{ path_for('profil', user) }}">
                            <h4 class="w3-margin-left w3-left w3-theme-l1">{{ user.pseudo }}</h4>
                        </a>
                    </div>
                        <img src="{{ user.img1 }}" class="w3-right" style="width:50%">
                        <p class="w3-small" style="margin-top:0">{{ user.gender }}, {{ 2018 - user.birthdate }}: {{ user.biography }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
        <div class="w3-twothird">
            <h3 class="w3-hover-green" style="cursor:pointer" onclick="toggleDisplay('map')">Map</h3>
            <div id="map" class="gg-map-med"></div>
        </div>
        <div class="w3-third">
            <h3 class="w3-hover-green" style="cursor:pointer" onclick="toggleDisplay('focus')">Focus</h3>
            <div id="focus">
            {% for user in users %}
            <div class="hide" id="{{ user.id }}">
                <div class="w3-theme-l4" style="height:100px;overflow:auto">
                    <div class="w3-theme-l1" style="width:100%;height:31px;position:sticky;top:0">
                        <a href="{{ path_for('profil', user) }}">
                            <h4 class="w3-margin-left w3-left w3-theme-l1">{{ user.pseudo }}</h4>
                        </a>
                        <i class="w3-button w3-right fa fa-remove w3-hover-red" onclick="closeInfo({{ user.id }})"></i>
                    </div>
                        <img src="{{ user.img1 }}" class="w3-right" style="width:50%">
                        <p class="w3-small" style="margin-top:0">{{ user.gender }}, {{ 2018 - user.birthdate }}: {{ user.biography }}</p>
                </div>
            </div>
            {% endfor %}
            </div>
        </div>
    </div>
    <form action="{{ path_for('searchByName') }}" method="post" class="w3-col l4">
        <h3 class="w3-hover-green" style="cursor:pointer" onclick="toggleDisplay('sbyname')">Search By Name</h3>
        <fieldset id="sbyname" class="w3-row w3-section w3-hide">
            <legend>Search by Name</legend>
            {{ input('text', '', {'value': '','placeholder':'pseudo', 'class':'w3-section w3-col s12 m9 l6', 'name': 'pseudo'}) }}
        {{ button('submit', 'search') }}
        </fieldset>
    </form>
    <form action="{{ path_for('searchByCriteria') }}" method="post" class="w3-col l4">
        <h3 class="w3-hover-green" style="cursor:pointer" onclick="toggleDisplay('sbyc')">Search by Criteria</h3>
        <fieldset id="sbyc" class="w3-row w3-hide">
            <legend>Search by Criteria</legend>
            <div class="w3-row w3-margin-bottom">
            <div class="w3-half">
                <h3 class="w3-theme-l1">age</h3>
                <div class="w3-col s6">
            {{ input(
            'number',
            'min',
            {
            'value': age.min,
            'min': 18,
            'max': 118,
            'name': 'min',
            'style': 'width:90%'
            })
            }}
                </div>
                <div class="w3-col s6">
            {{ input(
            'number',
            'max',
            {
            'value': age.max,
            'min': 18,
            'max': 118,
            'name': 'max',
            'style': 'width:90%'
            })
            }}
                </div>
            </div>
            <div class="w3-half" style="text-align:center">
                <h3 class="w3-theme-l1">distance</h3>
            {{ select({
            'label': 'up to â€¦ km',
            'name': 'distance',
            'array': distance,
            'select': distSel,
            'style': 'width:85%;'
            })
            }}
            </div>
            </div>
            <div class="w3-row">
            <div class="w3-half">
                <h3 class="w3-theme-l1">kind</h3>
                <select name="gender" size="5" style="width:100%">
                    {% for char in target %}
                    <option value="{{ char }}">{{ char }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="w3-half">
                <h3 class="w3-theme-l1">interest</h3>
                <select name="tags" size="5" style="width:100%">
                    {% for tag in tags %}
                        <option value="{{ tag }}">{{ tag }}</option>
                    {% endfor %}
                </select>
                <div id="" class=""></div>
            </div>
            </div>
        {{ button('submit', 'search') }}
        </fieldset>
    </form>
{% endblock %}

{% block script %}
<script>
var myPos = {lat: {{ me.lattitude }}, lng: {{ me.longitude }}};
var usersPos = [
{% for user in users %}
    {lat: {{ user.lattitude }}, lng: {{ user.longitude }}, title: '{{ user.pseudo }}', img: '{{ user.img1 }}', id: '{{ user.id }}', kind: '{{ user.gender }}'},
{% endfor %}
];
var myId = '{{ me.publicToken }}';

</script>
<!--<script src="googleMap/markerclusterer/src/markerclusterer.js"></script>-->
<script src="js/autobahn.js"></script>
<script src="js/displayForm.js"></script>
<script src="js/notification.js"></script>
<script src="js/mapSearch.js"></script>
<script defer async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCX5TOwSdL7R_-0S6h8-vQ7qz_tiebuwPg&callback=initMap"></script>
    </div>
</div>
{% endblock %} 
